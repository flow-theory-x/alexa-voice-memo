# 家族共有機能ガイド

*最終更新: 2025-07-14*

## 🏠 家族共有機能の概要

Voice Memoの家族共有機能は、メモを家族メンバー間で簡単に共有できる機能です。招待コードを使った簡単な参加と、日本の家族制度を反映した用語を採用しています。

## 📖 基本概念と用語

### 家族の役割

| 役割 | 説明 | 権限 |
|------|------|------|
| **当主（とうしゅ）** | 家族グループの管理者 | 全機能の利用、メンバー管理、家督譲渡 |
| **家族メンバー** | 通常のメンバー | メモの追加・編集・削除、退出 |

### 主要な用語

- **家族を作る**: 新しい家族グループを作成（招待コード生成）
- **家族に参加**: 招待コードを使って既存の家族に参加
- **家督を譲る（かとくをゆずる）**: 当主の権限を他のメンバーに移譲
- **家族から退出**: 家族グループから離脱（個人状態に戻る）

## 🎯 機能の使い方

### 1. 家族の作成と招待

**当主になる（家族を作る）**
1. メニューから「家族を作る」を選択
2. 4桁の招待コードが自動生成される
3. このコードを家族に共有（5分間有効）

```
招待コード: 1234
有効期限: 5分間
```

### 2. 家族への参加

**家族メンバーになる**
1. メニューから「家族に参加」を選択
2. 受け取った4桁の招待コードを入力
3. 参加確認後、自動的に既存メモが統合される

**メモの統合について**
- 参加時に個人のメモは自動的に家族メモに移行
- Alexaで作成したメモも同様に統合される
- 退出時は自分が作成したメモのみ持ち出し可能

### 3. 家督相続（当主の権限移譲）

**家督を譲る手順**
1. 当主がメニューから「家督を譲る」を選択
2. 譲渡先のメンバーをドロップダウンから選択
3. 確認ダイアログで「はい」を選択
4. 選ばれたメンバーが新しい当主になる

**制限事項**
- 当主のみが実行可能
- 最低2人以上のメンバーが必要
- 譲渡後は元に戻せない（再度譲渡は可能）

### 4. 家族からの退出

**通常メンバーの退出**
1. メニューから「家族から退出」を選択
2. 確認ダイアログで「はい」を選択
3. 自分が作成したメモのみを持って個人状態に戻る

**当主の退出制限**
- 当主は直接退出できません
- 先に家督を他のメンバーに譲る必要があります
- または全メンバーが退出して最後の1人になれば自動的に個人状態に戻ります

## 🔄 メニューの動的表示

Voice Memoのメニューは、ユーザーの状態に応じて自動的に表示項目が変わります：

### 個人状態（家族に属していない）
- ✅ 家族を作る
- ✅ 家族に参加
- ❌ 家族から退出（表示されない）
- ❌ 家督を譲る（表示されない）

### 家族メンバー（当主以外）
- ❌ 家族を作る（表示されない）
- ❌ 家族に参加（表示されない）
- ✅ 家族から退出
- ❌ 家督を譲る（表示されない）

### 当主
- ❌ 家族を作る（表示されない）
- ❌ 家族に参加（表示されない）
- ✅ 家族から退出（クリック時に家督譲渡を促す）
- ✅ 家督を譲る（2人以上のメンバーがいる場合のみ）

## 💡 使用例

### シナリオ1: 新しい家族グループの作成
```
太郎さん: 「家族を作る」→ 招待コード「1234」を取得
花子さん: 「家族に参加」→ コード「1234」を入力 → 参加完了
次郎さん: 「家族に参加」→ コード「1234」を入力 → 参加完了

結果: 太郎さんが当主の3人家族グループが完成
```

### シナリオ2: 当主の交代
```
現状: 太郎さん（当主）、花子さん、次郎さん

太郎さん: 「家督を譲る」→ 花子さんを選択 → 確認
結果: 花子さんが新しい当主に

太郎さん: 通常メンバーとして「家族から退出」が可能に
```

### シナリオ3: Alexaとの連携
```
1. 太郎さんがAlexaで「牛乳を買う」をメモ
2. 花子さんがWebで確認 → 太郎さんのメモが表示される
3. 花子さんがWebで「完了」にチェック
4. 太郎さんがAlexaで「メモを読んで」→ 完了済みなので読み上げられない
```

## ⚠️ 注意事項

### データの扱い
- 家族参加時: 個人メモは全て家族メモになります
- 家族退出時: 自分が作成したメモのみ持ち出せます
- 他のメンバーが作成したメモは家族に残ります

### 招待コードについて
- 有効期限は5分間
- 期限切れの場合は新しいコードを生成してください
- コードは4桁の数字でセキュリティは限定的です

### 当主の責任
- メンバー全員のメモを管理する責任があります
- 退出する場合は必ず後継者を指名してください
- 最後の1人になるまで退出できません

## 🔧 トラブルシューティング

### Q: 招待コードが無効と表示される
A: コードの有効期限（5分）が切れている可能性があります。新しいコードを生成してもらってください。

### Q: 当主が退出できない
A: 家督を他のメンバーに譲ってから退出してください。メンバーが自分だけの場合は、他のメンバーが全員退出するのを待つ必要があります。

### Q: メモが消えた
A: 家族に参加/退出時のメモ移行を確認してください。自分が作成したメモは必ず保持されます。

### Q: Alexaで作ったメモがWebに表示されない
A: 同じGoogleアカウントでログインしているか確認してください。Alexa側のアカウントリンクも確認が必要です。

## 📈 今後の拡張予定

- 家族メンバーの権限設定（読み取り専用など）
- メモのカテゴリ分け機能
- 家族内でのメモ担当者割り当て
- 招待リンクによる参加機能

---

*このガイドは家族共有機能の使い方を説明しています。技術的な詳細については[family-concept-verification.md](family-concept-verification.md)を参照してください。*