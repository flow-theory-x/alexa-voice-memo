"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const memo_service_1 = require("./memo-service");
const memoService = new memo_service_1.MemoService();
const handler = async (event) => {
    console.log('Request:', JSON.stringify(event, null, 2));
    try {
        const requestType = event.request.type;
        const userId = event.session.user.userId;
        switch (requestType) {
            case 'LaunchRequest':
                return buildResponse('ボイスメモへようこそ。メモを追加、読み上げ、削除ができます。何をしますか？', false);
            case 'IntentRequest':
                return await handleIntent(event, userId);
            case 'SessionEndedRequest':
                return buildResponse('', true);
            default:
                return buildResponse('申し訳ありません、理解できませんでした。', true);
        }
    }
    catch (error) {
        console.error('Handler error:', error);
        return buildResponse('申し訳ありません、エラーが発生しました。', true);
    }
};
exports.handler = handler;
async function handleIntent(event, userId) {
    const intentName = event.request.intent?.name;
    switch (intentName) {
        case 'AddMemoIntent':
            return await handleAddMemo(event, userId);
        case 'ReadMemosIntent':
            return await handleReadMemos(userId);
        case 'DeleteMemoIntent':
            return await handleDeleteMemo(event, userId);
        case 'AMAZON.HelpIntent':
            return buildResponse('ボイスメモでは、メモの追加、読み上げ、削除ができます。例えば「牛乳を買うをメモに追加」や「メモを読んで」と言ってください。', false);
        case 'AMAZON.CancelIntent':
        case 'AMAZON.StopIntent':
            return buildResponse('さようなら。', true);
        default:
            return buildResponse('申し訳ありません、その機能はまだ対応していません。', false);
    }
}
async function handleAddMemo(event, userId) {
    try {
        const memoText = event.request.intent?.slots?.memoText?.value;
        if (!memoText) {
            return buildResponse('申し訳ありません、メモの内容が聞き取れませんでした。もう一度お試しください。', false);
        }
        await memoService.addMemo(userId, memoText);
        return buildResponse(`${memoText}をメモに追加しました。`, false);
    }
    catch (error) {
        console.error('Add memo error:', error);
        return buildResponse('申し訳ありません、メモの追加に失敗しました。', false);
    }
}
async function handleReadMemos(userId) {
    try {
        const memos = await memoService.getActiveMemos(userId);
        if (memos.length === 0) {
            return buildResponse('メモはありません。', false);
        }
        let response = `メモが${memos.length}件あります。`;
        memos.forEach((memo, index) => {
            response += `${index + 1}番目、${memo.text}。`;
        });
        return buildResponse(response, false);
    }
    catch (error) {
        console.error('Read memos error:', error);
        return buildResponse('申し訳ありません、メモの読み上げに失敗しました。', false);
    }
}
async function handleDeleteMemo(event, userId) {
    try {
        const memoNumber = event.request.intent?.slots?.memoNumber?.value;
        if (!memoNumber) {
            return buildResponse('申し訳ありません、削除するメモの番号が聞き取れませんでした。', false);
        }
        const memos = await memoService.getActiveMemos(userId);
        const index = parseInt(memoNumber) - 1;
        if (index < 0 || index >= memos.length) {
            return buildResponse('申し訳ありません、その番号のメモは存在しません。', false);
        }
        await memoService.deleteMemo(userId, memos[index].memoId);
        return buildResponse(`${index + 1}番目のメモを削除しました。`, false);
    }
    catch (error) {
        console.error('Delete memo error:', error);
        return buildResponse('申し訳ありません、メモの削除に失敗しました。', false);
    }
}
function buildResponse(outputText, shouldEndSession = false) {
    return {
        version: '1.0',
        response: {
            outputSpeech: {
                type: 'PlainText',
                text: outputText
            },
            shouldEndSession
        }
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGFuZGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImhhbmRsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0EsaURBQTZDO0FBRTdDLE1BQU0sV0FBVyxHQUFHLElBQUksMEJBQVcsRUFBRSxDQUFDO0FBRS9CLE1BQU0sT0FBTyxHQUFHLEtBQUssRUFBRSxLQUFtQixFQUEwQixFQUFFO0lBQzNFLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRXhELElBQUksQ0FBQztRQUNILE1BQU0sV0FBVyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO1FBQ3ZDLE1BQU0sTUFBTSxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUV6QyxRQUFRLFdBQVcsRUFBRSxDQUFDO1lBQ3BCLEtBQUssZUFBZTtnQkFDbEIsT0FBTyxhQUFhLENBQUMsdUNBQXVDLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFFdkUsS0FBSyxlQUFlO2dCQUNsQixPQUFPLE1BQU0sWUFBWSxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztZQUUzQyxLQUFLLHFCQUFxQjtnQkFDeEIsT0FBTyxhQUFhLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBRWpDO2dCQUNFLE9BQU8sYUFBYSxDQUFDLHNCQUFzQixFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3ZELENBQUM7SUFDSCxDQUFDO0lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDdkMsT0FBTyxhQUFhLENBQUMsc0JBQXNCLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDckQsQ0FBQztBQUNILENBQUMsQ0FBQztBQXhCVyxRQUFBLE9BQU8sV0F3QmxCO0FB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QUFDLFVBQVUsRUFBRSxDQUFDO1lBQ2hCLE9BQU8sYUFBYSxDQUFDLGdDQUFnQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ2hFLENBQUM7UUFFRCxNQUFNLEtBQUssR0FBRyxNQUFNLFdBQVcsQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDdkQsTUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUV2QyxJQUFJLEtBQUssR0FBRyxDQUFDLElBQUksS0FBSyxJQUFJLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUN2QyxPQUFPLGFBQWEsQ0FBQywwQkFBMEIsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUMxRCxDQUFDO1FBRUQsTUFBTSxXQUFXLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDMUQsT0FBTyxhQUFhLENBQUMsR0FBRyxLQUFLLEdBQUcsQ0FBQyxlQUFlLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFFM0QsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDZixPQUFPLENBQUMsS0FBSyxDQUFDLG9CQUFvQixFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzNDLE9BQU8sYUFBYSxDQUFDLHdCQUF3QixFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3hELENBQUM7QUFDSCxDQUFDO0FBRUQsU0FBUyxhQUFhLENBQUMsVUFBa0IsRUFBRSxtQkFBNEIsS0FBSztJQUMxRSxPQUFPO1FBQ0wsT0FBTyxFQUFFLEtBQUs7UUFDZCxRQUFRLEVBQUU7WUFDUixZQUFZLEVBQUU7Z0JBQ1osSUFBSSxFQUFFLFdBQVc7Z0JBQ2pCLElBQUksRUFBRSxVQUFVO2FBQ2pCO1lBQ0QsZ0JBQWdCO1NBQ2pCO0tBQ0YsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBbGV4YVJlcXVlc3QsIEFsZXhhUmVzcG9uc2UgfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB7IE1lbW9TZXJ2aWNlIH0gZnJvbSAnLi9tZW1vLXNlcnZpY2UnO1xuXG5jb25zdCBtZW1vU2VydmljZSA9IG5ldyBNZW1vU2VydmljZSgpO1xuXG5leHBvcnQgY29uc3QgaGFuZGxlciA9IGFzeW5jIChldmVudDogQWxleGFSZXF1ZXN0KTogUHJvbWlzZTxBbGV4YVJlc3BvbnNlPiA9PiB7XG4gIGNvbnNvbGUubG9nKCdSZXF1ZXN0OicsIEpTT04uc3RyaW5naWZ5KGV2ZW50LCBudWxsLCAyKSk7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCByZXF1ZXN0VHlwZSA9IGV2ZW50LnJlcXVlc3QudHlwZTtcbiAgICBjb25zdCB1c2VySWQgPSBldmVudC5zZXNzaW9uLnVzZXIudXNlcklkO1xuXG4gICAgc3dpdGNoIChyZXF1ZXN0VHlwZSkge1xuICAgICAgY2FzZSAnTGF1bmNoUmVxdWVzdCc6XG4gICAgICAgIHJldHVybiBidWlsZFJlc3BvbnNlKCfjg5zjgqTjgrnjg6Hjg6LjgbjjgojjgYbjgZPjgZ3jgILjg6Hjg6LjgpLov73liqDjgIHoqq3jgb/kuIrjgZLjgIHliYrpmaTjgYzjgafjgY3jgb7jgZnjgILkvZXjgpLjgZfjgb7jgZnjgYvvvJ8nLCBmYWxzZSk7XG5cbiAgICAgIGNhc2UgJ0ludGVudFJlcXVlc3QnOlxuICAgICAgICByZXR1cm4gYXdhaXQgaGFuZGxlSW50ZW50KGV2ZW50LCB1c2VySWQpO1xuXG4gICAgICBjYXNlICdTZXNzaW9uRW5kZWRSZXF1ZXN0JzpcbiAgICAgICAgcmV0dXJuIGJ1aWxkUmVzcG9uc2UoJycsIHRydWUpO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gYnVpbGRSZXNwb25zZSgn55Sz44GX6Kiz44GC44KK44G+44Gb44KT44CB55CG6Kej44Gn44GN44G+44Gb44KT44Gn44GX44Gf44CCJywgdHJ1ZSk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0hhbmRsZXIgZXJyb3I6JywgZXJyb3IpO1xuICAgIHJldHVybiBidWlsZFJlc3BvbnNlKCfnlLPjgZfoqLPjgYLjgorjgb7jgZvjgpPjgIHjgqjjg6njg7zjgYznmbrnlJ/jgZfjgb7jgZfjgZ/jgIInLCB0cnVlKTtcbiAgfVxufTtcblxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlSW50ZW50KGV2ZW50OiBBbGV4YVJlcXVlc3QsIHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxBbGV4YVJlc3BvbnNlPiB7XG4gIGNvbnN0IGludGVudE5hbWUgPSBldmVudC5yZXF1ZXN0LmludGVudD8ubmFtZTtcblxuICBzd2l0Y2ggKGludGVudE5hbWUpIHtcbiAgICBjYXNlICdBZGRNZW1vSW50ZW50JzpcbiAgICAgIHJldHVybiBhd2FpdCBoYW5kbGVBZGRNZW1vKGV2ZW50LCB1c2VySWQpO1xuICAgIFxuICAgIGNhc2UgJ1JlYWRNZW1vc0ludGVudCc6XG4gICAgICByZXR1cm4gYXdhaXQgaGFuZGxlUmVhZE1lbW9zKHVzZXJJZCk7XG4gICAgXG4gICAgY2FzZSAnRGVsZXRlTWVtb0ludGVudCc6XG4gICAgICByZXR1cm4gYXdhaXQgaGFuZGxlRGVsZXRlTWVtbyhldmVudCwgdXNlcklkKTtcbiAgICBcbiAgICBjYXNlICdBTUFaT04uSGVscEludGVudCc6XG4gICAgICByZXR1cm4gYnVpbGRSZXNwb25zZShcbiAgICAgICAgJ+ODnOOCpOOCueODoeODouOBp+OBr+OAgeODoeODouOBrui/veWKoOOAgeiqreOBv+S4iuOBkuOAgeWJiumZpOOBjOOBp+OBjeOBvuOBmeOAguS+i+OBiOOBsOOAjOeJm+S5s+OCkuiyt+OBhuOCkuODoeODouOBq+i/veWKoOOAjeOChOOAjOODoeODouOCkuiqreOCk+OBp+OAjeOBqOiogOOBo+OBpuOBj+OBoOOBleOBhOOAgicsXG4gICAgICAgIGZhbHNlXG4gICAgICApO1xuICAgIFxuICAgIGNhc2UgJ0FNQVpPTi5DYW5jZWxJbnRlbnQnOlxuICAgIGNhc2UgJ0FNQVpPTi5TdG9wSW50ZW50JzpcbiAgICAgIHJldHVybiBidWlsZFJlc3BvbnNlKCfjgZXjgojjgYbjgarjgonjgIInLCB0cnVlKTtcbiAgICBcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIGJ1aWxkUmVzcG9uc2UoJ+eUs+OBl+ios+OBguOCiuOBvuOBm+OCk+OAgeOBneOBruapn+iDveOBr+OBvuOBoOWvvuW/nOOBl+OBpuOBhOOBvuOBm+OCk+OAgicsIGZhbHNlKTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVBZGRNZW1vKGV2ZW50OiBBbGV4YVJlcXVlc3QsIHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxBbGV4YVJlc3BvbnNlPiB7XG4gIHRyeSB7XG4gICAgY29uc3QgbWVtb1RleHQgPSBldmVudC5yZXF1ZXN0LmludGVudD8uc2xvdHM/Lm1lbW9UZXh0Py52YWx1ZTtcbiAgICBcbiAgICBpZiAoIW1lbW9UZXh0KSB7XG4gICAgICByZXR1cm4gYnVpbGRSZXNwb25zZSgn55Sz44GX6Kiz44GC44KK44G+44Gb44KT44CB44Oh44Oi44Gu5YaF5a6544GM6IGe44GN5Y+W44KM44G+44Gb44KT44Gn44GX44Gf44CC44KC44GG5LiA5bqm44GK6Kmm44GX44GP44Gg44GV44GE44CCJywgZmFsc2UpO1xuICAgIH1cblxuICAgIGF3YWl0IG1lbW9TZXJ2aWNlLmFkZE1lbW8odXNlcklkLCBtZW1vVGV4dCk7XG4gICAgcmV0dXJuIGJ1aWxkUmVzcG9uc2UoYCR7bWVtb1RleHR944KS44Oh44Oi44Gr6L+95Yqg44GX44G+44GX44Gf44CCYCwgZmFsc2UpO1xuICAgIFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0FkZCBtZW1vIGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gYnVpbGRSZXNwb25zZSgn55Sz44GX6Kiz44GC44KK44G+44Gb44KT44CB44Oh44Oi44Gu6L+95Yqg44Gr5aSx5pWX44GX44G+44GX44Gf44CCJywgZmFsc2UpO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVJlYWRNZW1vcyh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8QWxleGFSZXNwb25zZT4ge1xuICB0cnkge1xuICAgIGNvbnN0IG1lbW9zID0gYXdhaXQgbWVtb1NlcnZpY2UuZ2V0QWN0aXZlTWVtb3ModXNlcklkKTtcbiAgICBcbiAgICBpZiAobWVtb3MubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gYnVpbGRSZXNwb25zZSgn44Oh44Oi44Gv44GC44KK44G+44Gb44KT44CCJywgZmFsc2UpO1xuICAgIH1cblxuICAgIGxldCByZXNwb25zZSA9IGDjg6Hjg6LjgYwke21lbW9zLmxlbmd0aH3ku7bjgYLjgorjgb7jgZnjgIJgO1xuICAgIG1lbW9zLmZvckVhY2goKG1lbW8sIGluZGV4KSA9PiB7XG4gICAgICByZXNwb25zZSArPSBgJHtpbmRleCArIDF955Wq55uu44CBJHttZW1vLnRleHR944CCYDtcbiAgICB9KTtcblxuICAgIHJldHVybiBidWlsZFJlc3BvbnNlKHJlc3BvbnNlLCBmYWxzZSk7XG4gICAgXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignUmVhZCBtZW1vcyBlcnJvcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIGJ1aWxkUmVzcG9uc2UoJ+eUs+OBl+ios+OBguOCiuOBvuOBm+OCk+OAgeODoeODouOBruiqreOBv+S4iuOBkuOBq+WkseaVl+OBl+OBvuOBl+OBn+OAgicsIGZhbHNlKTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVEZWxldGVNZW1vKGV2ZW50OiBBbGV4YVJlcXVlc3QsIHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxBbGV4YVJlc3BvbnNlPiB7XG4gIHRyeSB7XG4gICAgY29uc3QgbWVtb051bWJlciA9IGV2ZW50LnJlcXVlc3QuaW50ZW50Py5zbG90cz8ubWVtb051bWJlcj8udmFsdWU7XG4gICAgXG4gICAgaWYgKCFtZW1vTnVtYmVyKSB7XG4gICAgICByZXR1cm4gYnVpbGRSZXNwb25zZSgn55Sz44GX6Kiz44GC44KK44G+44Gb44KT44CB5YmK6Zmk44GZ44KL44Oh44Oi44Gu55Wq5Y+344GM6IGe44GN5Y+W44KM44G+44Gb44KT44Gn44GX44Gf44CCJywgZmFsc2UpO1xuICAgIH1cblxuICAgIGNvbnN0IG1lbW9zID0gYXdhaXQgbWVtb1NlcnZpY2UuZ2V0QWN0aXZlTWVtb3ModXNlcklkKTtcbiAgICBjb25zdCBpbmRleCA9IHBhcnNlSW50KG1lbW9OdW1iZXIpIC0gMTtcbiAgICBcbiAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IG1lbW9zLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIGJ1aWxkUmVzcG9uc2UoJ+eUs+OBl+ios+OBguOCiuOBvuOBm+OCk+OAgeOBneOBrueVquWPt+OBruODoeODouOBr+WtmOWcqOOBl+OBvuOBm+OCk+OAgicsIGZhbHNlKTtcbiAgICB9XG5cbiAgICBhd2FpdCBtZW1vU2VydmljZS5kZWxldGVNZW1vKHVzZXJJZCwgbWVtb3NbaW5kZXhdLm1lbW9JZCk7XG4gICAgcmV0dXJuIGJ1aWxkUmVzcG9uc2UoYCR7aW5kZXggKyAxfeeVquebruOBruODoeODouOCkuWJiumZpOOBl+OBvuOBl+OBn+OAgmAsIGZhbHNlKTtcbiAgICBcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdEZWxldGUgbWVtbyBlcnJvcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIGJ1aWxkUmVzcG9uc2UoJ+eUs+OBl+ios+OBguOCiuOBvuOBm+OCk+OAgeODoeODouOBruWJiumZpOOBq+WkseaVl+OBl+OBvuOBl+OBn+OAgicsIGZhbHNlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBidWlsZFJlc3BvbnNlKG91dHB1dFRleHQ6IHN0cmluZywgc2hvdWxkRW5kU2Vzc2lvbjogYm9vbGVhbiA9IGZhbHNlKTogQWxleGFSZXNwb25zZSB7XG4gIHJldHVybiB7XG4gICAgdmVyc2lvbjogJzEuMCcsXG4gICAgcmVzcG9uc2U6IHtcbiAgICAgIG91dHB1dFNwZWVjaDoge1xuICAgICAgICB0eXBlOiAnUGxhaW5UZXh0JyxcbiAgICAgICAgdGV4dDogb3V0cHV0VGV4dFxuICAgICAgfSxcbiAgICAgIHNob3VsZEVuZFNlc3Npb25cbiAgICB9XG4gIH07XG59Il19